> HTTP协议是无状态的协议,没有连接的. 所以需要一种机制能够跟踪一个用户,实现一种认证机制
>
> 会话管理包括Cookie和Session两种

# Cookie

## 用途

cookie是服务器暂时存放在用户计算机中的数据,好让服务器能够知道到底是哪个用户访问.当我们浏览网站时候Web服务器就会先查看有没有他上次留下的Cookie数据，如果有的话，就会依据Cookie中的内容判断使用者

简单说就是服务器可以通过Cookie辨认使用者

## 位置

Cookie文件通常是以`user@domain`格式命名。

* `user`    本地用户名
* `domain`  所访问的网站的域名

位置

* win2000,winXP`C:\Documents and Settings\用户名\Local
 Settings\Temporary Internet Files`
* win7,Vista `C:\Users\用户名\AppData\Local\Microsoft\Windows\Temporary Internet Files`


## 内容

* 名字
* 值
* 过期时间
* 路径
* 域

> 路径与域构成Cookie的作用范围
>
> 时间不设置表示生命周期为浏览器会话期间(直到关闭浏览器)

Cookie的发送是通过扩展HTTP协议来实现的.Web服务器通过在HTTP的响应头中加上一行特殊的提示,来告诉浏览器按照指定生成相应的Cookie.

Cookie的使用则是由浏览器按照一定的原则在后台自动发送给Web服务器的,如果一个Cookie声明的作用范围大于等于请求资源的范围,则把这个Cookie附在请求资源的HTTP请求头上发送给服务器


# Session

## 与Cookie区别

* Cookie存放在客户端,Session存放在服务端
* 单个Cookie文件在客户端大小限制是3K,而Session没有限制
* Cookie易被XSS窃取,不安全
* Session过多会降低服务器性能

**重要信息保存Session,其他信息Cookie**

# Cookie管理

## 设置

Cookie是HTTP协议头的组成部分,必须在页面其他内容出现之前发送,因此,在**设置Cookie之前不能有任何文本输出**包括`HTML`标记,输出语句以及空行

PHP中通过`setcookie()`函数创建Cookie

```php
bool setcookie( string $name[, string $value
              [, int $expire = 0
              [, string $path
              [, string $domain
              [, bool $secure = false
              [, bool $httponly = false
              ]]]]]] )
```

除了$name以外,其他都是可选参数

```php
$name       //Cookie名字
$value      //Cookie保存在客户端的值,
            //可以通过$_COOKIE["name"]获取名字为name的Cookie的值
$expire     //Cookie的失效时间(Unix时间戳,通过mktime()或time()获取)
$path       //Cookie在服务器端有效的网站目录,用路径表示,如果设置为'/'表示这个Cookie在整个网站有效,如果是'/MO/'表示只在MO和子目录下有效

$domain     //Cookie有效的域名,如果设置为 .aa.com 表示在aa.com 所有子域名有效
            //www.aa.com 则表示只在 www 子域名有效
$secure     //是否通过HTTPS安全连接设置Cookie, 如果TRUE,则Cookie只存在HTTPS安全连接的前提下才会设置.
            //默认是 FALSE,表面HTTP和HTTPS都可用
$httponly   //是否通过HTTP协议设置Cookie,
            //如果设置为TRUE,则这个Cookie就不能被JavaScript这样的脚本使用
            //可以减少XSS攻击默认是false  php5.2.0有效
```

读取示例代码

```php
<?php
    $name = 'last_login_time';
    $value = date('Y-m-d H-i-s');

    setcookie($name, $value);     //永久有效    
    setcookie($name, $value, time()+3600*24);     //24小时候失效
    setcookie($name, $value, 0, '/Mo/');    //只在MO目录有效
    setcookie($name, $value, 0, '','www.mo.com',);    //只在指定域名有效
    setcookie($name, $value, 0, '', '', true);        //只能https协议
    setcookie($name, $value, 0, '', '', '', true);    //只能http协议
?>
```

## 读取

通过数组`$_COOKIE`

```php
<?php
    //设置时区
    date_default_timezone_set('Asia/Shanghai');
    $name = 'last_login_time';
    if(isset($_COOKIE[$name])){   //判断cookie
        echo 'you came here last time is '.$_COOKIE[$name].'<br>';
    }else{
        echo 'wellcome';
    }

    //新建或更新cookie
    setcookie($name, date('Y年m月d日 H时i分s秒'));
?
```

## 删除

如果想提前删除cookie,那么就只需要将有效时间设置成过去就行了

    setcookie('name', '', time()-1 );
